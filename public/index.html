<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tien Len Online</title>
</head>
<body>
    <h1>Tien Len Online</h1>

    <div id="nameSection">
        <input id="nameInput" placeholder="Your Name"/>
        <button onclick="setName()">Continue</button>
    </div>

    <div id="lobbySection" style="display:none">
        <h2>Create Lobby</h2>
        <input id="lobbyName" placeholder="Lobby name" />
        <button onclick="createLobby()">Create</button>

        <h2>Join Lobby</h2>
        <input id="codeInput" placeholder="Lobby code" />
        <button onclick="joinLobby()">Join</button>
    </div>

    <h2 id="lobbyTitle"></h2>
    <ul id="players"></ul>
    
    <script src ="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        let playerName = "";

        function setName() {
            const input = document.getElementById("nameInput").value.trim();
            if (!input) {
                alert("Name required");
                return;
            }

            playerName = input;
            document.getElementById("nameSection").style.display = "none";
            document.getElementById("lobbySection").style.display = "block";
        }
        
        function createLobby() {
            const lobbyName = document.getElementById("lobbyName").value;
            socket.emit("createLobby", {playerName, lobbyName});
        }

        function joinLobby() {
            const code = document.getElementById("codeInput").value.toUpperCase();
            socket.emit("joinLobby", { code, playerName });
        }

        socket.on("lobbyCreated", ({code, lobbyName, players}) => {
            document.getElementById("lobbyTitle").innerText = `${lobbyName} (Code: ${code})`;
            updatePlayers(players);
        });

        socket.on("lobbyUpdated", ({lobbyName, players}) => {
            document.getElementById("lobbyTitle").innerText = lobbyName;
            updatePlayers(players);
        });

        socket.on("errorMessage", msg => {
            alert(msg);
        });

        function updatePlayers(players) {
            const list = document.getElementById("players");
            list.innerHTML = "";
            players.forEach(p => {
                const li = document.createElement("li");
                li.innerText = p.name;
                list.appendChild(li);
            });
        }
    </script>
</body>
</html>
